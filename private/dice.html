<!DOCTYPE html>
<html>
<head>
    <title>Ovládaná IoT Kostka</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { margin: 0; font-family: 'Segoe UI', sans-serif; height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; background-color: #ecf0f1; }
        #dice { font-size: 250px; color: #2c3e50; user-select: none; margin-bottom: 20px; }
        #roll-btn { 
            padding: 20px 60px; 
            font-size: 24px; 
            font-weight: bold; 
            background-color: #3498db; 
            color: white; 
            border: none; 
            border-radius: 50px; 
            cursor: pointer; 
            box-shadow: 0 6px #2980b9; 
            transition: transform 0.1s; 
        }
        #roll-btn:active { 
            transform: translateY(4px); 
            box-shadow: 0 2px #2980b9; 
        }
        .shake { animation: shake 0.5s linear; }
        @keyframes shake { 0% { transform: rotate(0deg); } 25% { transform: rotate(15deg); } 50% { transform: rotate(-15deg); } 75% { transform: rotate(5deg); } 100% { transform: rotate(0deg); } }
    </style>
</head>
<body>
    <div id="dice">&#9856;</div>
    <button id="roll-btn" onclick="rollDice()">Hoď Kostkou</button>
    <script>
        // --- KONFIGURACE BRIDGE SERVERU ---
        // PHP skript na novém hostingu, který uloží výsledek do magic_roll.txt
        const BRIDGE_URL = 'https://iot-dice-bridge.vercel.app/api/roll'; 

        let lastRolledNumber = 0; 
        
        // Funkce provádí výpočet, odesílání a zobrazení
        function rollDice() {
            const dice = document.getElementById('dice');
            const btn = document.getElementById('roll-btn');
            btn.disabled = true; 
            dice.classList.add('shake');
            
            setTimeout(() => {
                
                // 1. VÝPOČET NÁHODNÉHO ČÍSLA (na straně prohlížeče)
                let num;
                do {
                    num = Math.floor(Math.random() * 6) + 1; 
                } while (num === lastRolledNumber);
                
                lastRolledNumber = num;

                // 2. ODESLÁNÍ ČÍSLA NA BRIDGE SERVER (PHP)
                fetch(BRIDGE_URL, {
                    method: 'POST',
                    // Důležité: Typ dat pro PHP skript
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: `roll_value=${num}` // Odesílá číslo, které se má zapsat
                })
                .then(response => console.log('✅ Výsledek ' + num + ' odeslán na Bridge server.'))
                .catch(error => console.error('❌ Chyba při odesílání na Bridge:', error));


                // 3. ZOBRAZENÍ VÝSLEDKU V PROHLÍŽEČI
                // Používá Unicode symboly pro kostku (9856 = 1, 9857 = 2, atd.)
                dice.innerHTML = '&#' + (9855 + num) + ';';
                dice.classList.remove('shake'); 
                btn.disabled = false; 

            }, 500);
        }
    </script>
</body>
</html>
